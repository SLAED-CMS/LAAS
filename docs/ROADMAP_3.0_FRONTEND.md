# LAAS 3.0: Frontend-agnostic mode

## Цели и мотивация

- Развязать backend и UI, чтобы можно было менять фронтенд без правок PHP.
- Сохранить совместимость с v2.x (Classic mode).
- Стандартизировать контракты данных и ассетов.
- Упростить интеграции и автоматизированное тестирование UI.

## Что значит frontend-agnostic

Backend не зависит от конкретного HTML/CSS/JS-фреймворка.
UI может быть:
- серверным (HTML/HTMX),
- SPA/SSR на внешнем фронтенде,
- полностью headless (JSON API).

## Контракты (обязательные)

### UI tokens

Контракт данных, который описывает состояние UI без CSS-классов.

Checklist:
- [x] Контроллеры возвращают только `state|status|variant|flags`
- [x] В данных нет `*_class`
- [x] Маппинг токенов в классы выполняется в шаблонах

### Assets layer

Единый слой подключения статических ресурсов.

Checklist:
- [x] Все CSS/JS описаны в `config/assets.php`
- [x] Шаблоны подключают ассеты только через asset helpers
- [x] Нет inline `<style>/<script>` и `style=""`
- [x] Нет CDN в шаблонах

### Response formats

Единый контракт ответов.

Checklist:
- [x] HTML: полные страницы с layout
- [x] HTMX: частичные ответы без layout
- [ ] JSON: единый envelope (status, data, error, meta)

## Режимы

### Classic mode (v2.x совместимость)

- Серверные шаблоны (HTML + HTMX)
- Asset helpers активны
- UI tokens маппятся в шаблонах
- Контроллеры возвращают данные под HTML

### Headless mode

- Роуты возвращают JSON
- UI tokens обязательны
- Нет привязки к HTML-шаблонам
- Внешний frontend отвечает за рендер

## Этапы миграции (без ломки v2.x)

### Этап 1: Контракты и валидации
- [x] Зафиксировать UI tokens в код-стандартах
- [x] Ввести policy checks (inline/CND/asset rules)
- [x] Гарантировать глобальные переменные шаблонов

### Этап 2: Двойной формат ответов
- [ ] Ввести единый JSON envelope
- [x] Добавить переключатель режима ответа (HTML/JSON) на уровне контроллера
- [x] Документировать совместимость HTML/HTMX

### Этап 3: Рендеринг-адаптеры
- [x] Ввести слой адаптеров рендеринга (HTML/JSON)
- [ ] Развести view data и transport data
- [ ] Упростить повторное использование контроллеров

### Этап 4: Headless mode как стабильный
- [ ] Зафиксировать список headless endpoints
- [ ] Тесты контрактов для JSON
- [ ] Документация для интеграций

## Критерии готовности 3.0

- [x] UI tokens соблюдаются на всем проекте
- [x] Ассет-слой единый, без inline/CND
- [ ] Контракт JSON стабилен и покрыт тестами
- [x] Classic и Headless режимы поддерживаются параллельно
Implemented in v2.8.0: RenderAdapter v1
