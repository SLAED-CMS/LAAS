<tr id="user-{% user.id %}">
  <td>{% user.id %}</td>
  <td>
    <div class="fw-semibold">
      {% foreach user.username_segments as seg %}
        {% if seg.mark %}<mark>{% seg.text %}</mark>{% else %}{% seg.text %}{% endif %}
      {% endforeach %}
    </div>
    {% if user.email %}
    <div class="text-muted small">
      {% foreach user.email_segments as seg %}
        {% if seg.mark %}<mark>{% seg.text %}</mark>{% else %}{% seg.text %}{% endif %}
      {% endforeach %}
    </div>
    {% endif %}
  </td>
  <td>
    {% if user.status %}
    <span class="badge text-bg-success">{% t 'admin.users.active' %}</span>
    {% else %}
    <span class="badge text-bg-secondary">{% t 'admin.users.disabled' %}</span>
    {% endif %}
  </td>
  <td>
    {% if user.is_admin %}
    <span class="badge text-bg-primary">admin</span>
    {% else %}
    -
    {% endif %}
  </td>
  <td>{% user.last_login_at %}</td>
  <td>
    <div class="btn-group btn-group-sm" role="group">
      {% if user.protected %}
      <button class="btn btn-outline-secondary" type="button" disabled>{% t 'admin.users.disable' %}</button>
      <button class="btn btn-outline-secondary" type="button" disabled>{% t 'admin.users.remove_admin' %}</button>
      {% else %}
      <form method="post"
            class="d-inline"
            action="/admin/users/status"
            hx-post="/admin/users/status"
            hx-target="#user-{% user.id %}"
            hx-swap="outerHTML"
            hx-indicator="#loading"
            hx-vals='{"user_id":"{% user.id %}"}'>
        <input type="hidden" name="_token" value="{% csrf_token %}">
        {% if user.status %}
        <button class="btn btn-outline-danger" type="submit">{% t 'admin.users.disable' %}</button>
        {% else %}
        <button class="btn btn-outline-success" type="submit">{% t 'admin.users.enable' %}</button>
        {% endif %}
      </form>
      <form method="post"
            class="d-inline"
            action="/admin/users/admin"
            hx-post="/admin/users/admin"
            hx-target="#user-{% user.id %}"
            hx-swap="outerHTML"
            hx-indicator="#loading"
            hx-vals='{"user_id":"{% user.id %}"}'>
        <input type="hidden" name="_token" value="{% csrf_token %}">
        {% if user.is_admin %}
        <button class="btn btn-outline-warning" type="submit">{% t 'admin.users.remove_admin' %}</button>
        {% else %}
        <button class="btn btn-outline-primary" type="submit">{% t 'admin.users.make_admin' %}</button>
        {% endif %}
      </form>
      <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#user-pass-{% user.id %}" aria-expanded="false" aria-controls="user-pass-{% user.id %}">
        {% t 'admin.users.change_password' %}
      </button>
      <form method="post"
            class="d-inline"
            action="/admin/users/delete"
            hx-post="/admin/users/delete"
            hx-confirm="{% t 'admin.users.delete_confirm' %}"
            hx-target="#page-messages"
            hx-swap="innerHTML"
            hx-indicator="#loading">
        <input type="hidden" name="_token" value="{% csrf_token %}">
        <input type="hidden" name="user_id" value="{% user.id %}">
        <button class="btn btn-outline-danger" type="submit">{% t 'admin.users.delete' %}</button>
      </form>
      {% endif %}
    </div>
  </td>
</tr>
<tr class="collapse" id="user-pass-{% user.id %}">
  <td colspan="6">
    <form method="post"
          class="d-flex flex-wrap gap-2 align-items-end"
          action="/admin/users/password"
          hx-post="/admin/users/password"
          hx-target="#page-messages"
          hx-swap="innerHTML"
          hx-indicator="#loading">
      <input type="hidden" name="_token" value="{% csrf_token %}">
      <input type="hidden" name="user_id" value="{% user.id %}">
      <div>
        <label class="form-label mb-1">{% t 'admin.users.new_password' %}</label>
        <input class="form-control form-control-sm" type="password" name="password" minlength="8" autocomplete="new-password" required>
      </div>
      <button class="btn btn-sm btn-outline-primary" type="submit">{% t 'admin.users.change_password' %}</button>
    </form>
  </td>
</tr>
