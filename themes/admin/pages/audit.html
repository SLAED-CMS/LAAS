{% extends "layout.html" %}

{% block content %}
<div class="card">
  <div class="card-body">
  <h1 class="h4 mb-3">{% t 'admin.audit.title' %}</h1>
  <div id="page-messages">
    {% include "partials/messages.html" %}
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <div class="fw-semibold mb-2">{% t 'audit.filters.title' %}</div>
      <form method="get"
            action="/admin/audit"
            class="row g-2 align-items-end"
            hx-get="/admin/audit"
            hx-target="#audit-table"
            hx-swap="innerHTML"
            hx-indicator="#loading"
            hx-trigger="keyup changed delay:300ms from:#audit-user, change from:#audit-action, change from:#audit-from, change from:#audit-to">
        <div class="col-sm-3">
          <label class="form-label">{% t 'audit.filters.user' %}</label>
          <input class="form-control" id="audit-user" name="user" value="{% filters.user %}" list="audit-users">
          <datalist id="audit-users">
            {% foreach users as user %}
              <option value="{% user.username %}"></option>
            {% endforeach %}
          </datalist>
        </div>
        <div class="col-sm-3">
          <label class="form-label">{% t 'audit.filters.action' %}</label>
          <select class="form-select" id="audit-action" name="action">
            <option value="">-</option>
            {% foreach actions as action %}
              <option value="{% action.name %}" {% raw action.selected %}>{% action.name %}</option>
            {% endforeach %}
          </select>
        </div>
        <div class="col-sm-2">
          <label class="form-label">{% t 'audit.filters.from' %}</label>
          <input class="form-control" id="audit-from" type="date" name="from" value="{% filters.from %}">
        </div>
        <div class="col-sm-2">
          <label class="form-label">{% t 'audit.filters.to' %}</label>
          <input class="form-control" id="audit-to" type="date" name="to" value="{% filters.to %}">
        </div>
        <div class="col-sm-2 d-flex gap-2">
          <button class="btn btn-outline-secondary w-100" type="submit">{% t 'admin.audit.action' %}</button>
          <a class="btn btn-outline-secondary w-100" href="/admin/audit">{% t 'audit.filters.reset' %}</a>
        </div>
      </form>
    </div>
  </div>

  <div id="loading" class="htmx-indicator text-center my-3">
    <div class="spinner-border" role="status" aria-hidden="true"></div>
  </div>

  <div id="audit-table">
    {% include "partials/audit_table.html" %}
  </div>
  </div>
</div>
{% endblock %}
