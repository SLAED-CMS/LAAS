{% extends "layout.html" %}

{% block content %}
<div class="card">
  <div class="card-body">
    <div class="d-flex flex-wrap gap-2 mb-3">
      <span class="badge text-bg-success">Read-only by default</span>
      <span class="badge text-bg-info">Dry-run</span>
      <span class="badge text-bg-secondary">Sandbox</span>
      <span class="badge text-bg-warning">Apply requires CLI --yes</span>
    </div>
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h4 mb-0">AI Assistant</h1>
    </div>
    <p class="text-muted small mb-3">
      Read-only assistant. Propose, dry-run checks, then save the proposal for CLI apply.
    </p>
    <div class="mb-3">
      <label class="form-label" for="prompt">Prompt</label>
      <textarea class="form-control" id="prompt" name="prompt" rows="6"
                placeholder="Describe the change you want..."></textarea>
    </div>
    <div class="d-flex flex-wrap gap-2 mb-3">
      <button type="button"
              class="btn btn-primary"
              hx-post="/api/v1/ai/propose"
              hx-target="#ai-propose-out"
              hx-swap="innerHTML"
              hx-include="#prompt"
              hx-indicator="#ai-loading">
        Propose
      </button>
      <div class="small text-muted w-100">Generates proposal + plan (no writes).</div>
      <button type="button"
              class="btn btn-outline-secondary"
              hx-post="/api/v1/ai/run"
              hx-target="#ai-run-out"
              hx-swap="innerHTML"
              hx-include="#plan_json"
              hx-indicator="#ai-loading">
        Run Dry-Run
      </button>
      <div class="small text-muted w-100">Runs allowlisted checks only.</div>
      <button type="button"
              class="btn btn-outline-success"
              hx-post="/admin/ai/save-proposal"
              hx-target="#ai-save-out"
              hx-swap="innerHTML"
              hx-include="#proposal_json"
              hx-indicator="#ai-loading">
        Save Proposal
      </button>
      <div class="small text-muted w-100">Stores proposal JSON locally.</div>
    </div>
    <div id="ai-loading" class="htmx-indicator text-center my-3">
      <div class="spinner-border" role="status" aria-hidden="true"></div>
    </div>
    <div id="ai-propose-out"></div>
    <div id="ai-run-out"></div>
    <div id="ai-save-out" class="mt-3"></div>
    <div class="alert alert-warning mt-3 mb-0">
      <div class="fw-semibold">No apply in UI</div>
      <div class="small">Use CLI apply with <code>--yes</code> after saving.</div>
    </div>
  </div>
</div>
<div class="card mt-3">
  <div class="card-body">
    <h2 class="h5 mb-2">Dev Autopilot Preview</h2>
    <div class="text-muted small mb-3">Sandbox-only preview. Apply to repo requires CLI.</div>
    <div class="mb-3">
      <label class="form-label" for="ai_module_name">Module name</label>
      <input class="form-control form-control-sm" id="ai_module_name" name="module_name" maxlength="40" placeholder="DemoX">
    </div>
    <button type="button"
            class="btn btn-outline-primary btn-sm"
            hx-post="/admin/ai/dev-autopilot"
            hx-target="#ai-dev-out"
            hx-swap="innerHTML"
            hx-include="#ai_module_name"
            hx-indicator="#ai-loading">
      Dev Autopilot Preview
    </button>
    <div class="small text-muted mt-2">Sandbox scaffold preview only.</div>
    <div id="ai-dev-out" class="mt-3"></div>
  </div>
</div>
{% endblock %}
