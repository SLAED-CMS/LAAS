{% extends "layout.html" %}

{% block content %}
<div class="card shadow-sm border-primary mb-4">
  <div class="card-header d-flex align-items-center justify-content-between bg-primary bg-opacity-10">
    <h1 class="h5 mb-0">AI Assistant</h1>
    <span class="badge text-bg-secondary">Read-only</span>
  </div>
  <div class="card-body">
    <div class="d-flex flex-wrap gap-2 mb-3">
      <span class="badge text-bg-success">Read-only by default</span>
      <span class="badge text-bg-info">Dry-run</span>
      <span class="badge text-bg-secondary">Sandbox</span>
      <span class="badge text-bg-warning">Apply requires CLI --yes</span>
    </div>
    <div class="mt-2 d-flex align-items-center gap-2 flex-wrap">
      <span class="badge text-bg-primary">1) Propose</span>
      <span class="text-muted small">→</span>
      <span class="badge text-bg-secondary">2) Dry-run</span>
      <span class="text-muted small">→</span>
      <span class="badge text-bg-secondary">3) Save</span>
      <span class="text-muted small">→</span>
      <span class="badge text-bg-dark">4) CLI Apply (--yes)</span>
    </div>
    <div class="text-muted small mt-2 mb-3">Review diff and checks. UI never applies changes.</div>
    <p class="text-muted small mb-3">
      Read-only assistant. Propose, dry-run checks, then save the proposal for CLI apply.
    </p>
    <div class="mb-3">
      <label class="form-label" for="prompt">Prompt</label>
      <textarea class="form-control" id="prompt" name="prompt" rows="6"
                placeholder="Describe the change you want..."></textarea>
    </div>
    <div class="d-flex flex-wrap gap-2 mb-2">
      <button type="button"
              class="btn btn-primary"
              hx-post="/api/v1/ai/propose"
              hx-target="#ai-propose-out"
              hx-swap="innerHTML"
              hx-include="#prompt"
              hx-indicator="#ai-loading">
        Propose (Preview)
      </button>
      <button type="button"
              class="btn btn-outline-secondary"
              hx-post="/api/v1/ai/run"
              hx-target="#ai-run-out"
              hx-swap="innerHTML"
              hx-include="#plan_json"
              hx-indicator="#ai-loading">
        Run Dry-Run
      </button>
      <button type="button"
              class="btn btn-outline-success"
              hx-post="/admin/ai/save-proposal"
              hx-target="#ai-save-out"
              hx-swap="innerHTML"
              hx-include="#proposal_json"
              hx-indicator="#ai-loading">
        Save Proposal
      </button>
    </div>
    <div class="small text-muted mb-3">
      <div>Propose generates a plan without writing files.</div>
      <div>Dry-run executes allowlisted checks only.</div>
      <div>Save stores the proposal JSON for CLI apply.</div>
    </div>
    <div id="ai-loading" class="htmx-indicator text-center my-3">
      <div class="spinner-border" role="status" aria-hidden="true"></div>
    </div>
    <div id="ai-propose-out" class="mt-3 p-2 bg-light border rounded"></div>
    <div id="ai-run-out" class="mt-2 p-2 bg-light border rounded"></div>
    <div id="ai-save-out" class="mt-2 p-2 bg-light border rounded"></div>
    <div class="alert alert-warning mt-3 mb-0">
      <div class="fw-semibold">No apply in UI</div>
      <div class="small">Use CLI apply with <code>--yes</code> after saving.</div>
    </div>
  </div>
</div>
<div class="card shadow-sm border-warning">
  <div class="card-header bg-warning bg-opacity-10">
    <strong>Dev Autopilot Preview</strong>
  </div>
  <div class="card-body">
    <div class="text-muted small mb-3">Sandbox-only preview. Apply to repo requires CLI.</div>
    <div class="mb-3">
      <label class="form-label" for="ai_module_name">Module name</label>
      <input class="form-control form-control-sm" id="ai_module_name" name="module_name" maxlength="40" placeholder="DemoX">
    </div>
    <div class="d-flex align-items-center gap-2 flex-wrap">
      <button type="button"
              class="btn btn-outline-primary btn-sm"
              hx-post="/admin/ai/dev-autopilot"
              hx-target="#ai-dev-out"
              hx-swap="innerHTML"
              hx-include="#ai_module_name"
              hx-indicator="#ai-loading">
        Dev Autopilot Preview
      </button>
      <div class="small text-muted">Sandbox scaffold preview only.</div>
    </div>
    <div id="ai-dev-out" class="mt-3 p-2 bg-light border rounded small"></div>
  </div>
</div>
{% endblock %}
