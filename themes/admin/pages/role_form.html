{% extends "layout.html" %}

{% block content %}
<div class="card">
  <div class="card-body">
    <h1 class="h4 mb-3">{% if is_edit %}{% t 'admin.pages.edit' %}{% else %}{% t 'admin.pages.new' %}{% endif %}</h1>
    <div id="page-messages">
      {% include "partials/messages.html" %}
    </div>

    <form method="get"
          action="{% permissions_url %}"
          hx-get="{% permissions_url %}"
          hx-target="#permissions-list"
          hx-swap="innerHTML"
          hx-indicator="#loading"
          hx-trigger="keyup changed delay:300ms from:#perm-q"
          class="mb-2">
      <input class="form-control form-control-sm" id="perm-q" name="q" value="{% q %}" placeholder="{% t 'admin.search.placeholder' %}">
    </form>

    <form method="post" action="/admin/users/roles/save">
      <input type="hidden" name="_token" value="{% csrf_token %}">
      {% if role.id %}
      <input type="hidden" name="id" value="{% role.id %}">
      {% endif %}
      <div class="row g-3 mb-3">
        <div class="col-md-6">
          <label class="form-label">Name</label>
          <input class="form-control" name="name" value="{% role.name %}" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Title</label>
          <input class="form-control" name="title" value="{% role.title %}">
        </div>
      </div>

      <div class="fw-semibold mb-2">{% t 'admin.users.roles' %}</div>

      <div id="permissions-list">
        {% include "partials/role_permissions.html" %}
      </div>

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-primary" type="submit">{% t 'admin.settings.save' %}</button>
        <a class="btn btn-outline-secondary" href="/admin/users/roles">{% t 'audit.filters.reset' %}</a>
      </div>
    </form>

    <div id="loading" class="htmx-indicator text-center my-3">
      <div class="spinner-border" role="status" aria-hidden="true"></div>
    </div>
  </div>
</div>
{% endblock %}
